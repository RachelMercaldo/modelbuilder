# modelbuilder package information


## Package functionality requirements
* Users need to be able to build and analyze compartmental models without coding
* Ideally, the building and analysis/testing need to happen at the same time so users can test their model behavior as they build it to see if it works
* Things need to be reversible, i.e. for each compartment/variable and each inflow/outflow term, users need to be able to add/remove/edit
* Ideally, as model is being built, it should interactively show diagram and differential equations, as well as inputs for initial conditions and parameters so a user can run it.
* Users should be able to save models, load and modify models, import and export models
* We could have 2 tabs, a model 'building' that allows building and shows diagram and equations, and a 'testing' that shows inputs and outputs (that one similar to UI of DSAIDE/DSAIRM shiny apps). Currently, this is done with separate apps.
* The package needs to have lots of checks to make sure user doesn't do something detrimental
* Package also needs to have lots of internal (unit) tests (using testthat)


## Current package structure and concept ideas
* Currently, user loads package, starts main menu with `modelbuilder()`
* Main menu lets users build a new model, load an existing model, modify or analyze existing model, export code for existing model, and do import/export to SBML. Only some of the features are currently implemented/working.
* Each model is saved as list structure called 'model' and stored in Rdata files.
* Several functions take the model structure and turn it into R code/functions for implementing the model as ODE, stochastic/adaptivetau, discrete time, RxODE, SBML, etc. (only some implemented yet)
* As model is built, a diagram is drawn (maybe using DiagrammeR pacakge)
* As model is built, equations are written to screen as Latex/shiny output object 
* When user saves model, the model is written to an Rdata file


## Specific thoughts
* The generate_discrete and other functions create internal variables in the code, e.g. 'ts'. If a user happens to call one of their variables/compartments the same name, problems likely arise. Might have to rename our internal variables to something unlikely to conflict (e.g. ts_mb) and/or implement checks to prevent use of certain names.


## modelbuilder Model structure
We'll store a model as a list, and save it as Rdata file. 


The model list will have the components described below.
The following constraints are currently imposed:

* Variable names have to start with an upper-case letter and can only contain letters and numbers
* Parameter names have to start with a lower-case letter and can only contain letters and numbers



### Meta-Information
* `model$title` - model title
* `model$description` - a short (1 sentence) model description
* `model$author` - name of model author/creator
* `model$date` - date of creation or last change
* `model$details` - a detailed model description

### Variable information
* `model$var[[i]]$varname` - characters containing variable name, string
* `model$var[[i]]$vartext` - description of variable, string
* `model$var[[i]]$varval` - starting value, numeric
* `model$var[[i]]$flows` - all flow terms, as vector of strings
* `model$var[[i]]$flownames` - description of each flow, vector of strings

i = 1..number of variables

### Parameter information
* `model$par[[i]]$parname` - parameter name
* `model$par[[i]]$partext` - description of parameter 
* `model$par[[i]]$parval` - default value 

i = 1..number of parameters

### Time information
* `model$time[[i]]$timename` - tstart/tfinal/dt (fixed names, in that order)
* `model$time[[i]]$timetext` - text  
* `model$time[[i]]$timeval` - default value

i = 1,2,3 being tstart, tfinal and dt


### Optional/for later:
* `model$par[[i]]$lb` - lower bound for parameter 
* `model$par[[i]]$ub` - upper bound for parameter 

### Model examples
Several model examples following the above structure (and currently generated by hand with the XX_model_object.R scripts) are in the `\inst\modelexamples` folder



## general thoughts and ideas
* Integrate with Systems Biology Markup Language (SBML)
* Use DiagrammeR package for graph creation?
* Do (and write/publish?) a review of software out there that does what we want to do? See e.g. here for a table of various software packages: https://en.wikipedia.org/wiki/Comparison_of_system_dynamics_software
* Go through medley18pcb
* A series of reviews of GUI's for R data analyis: http://r4stats.com/articles/software-reviews/  Might give us some pointers as to ways of doing GUI things for our purpose
* There is a Systems Dynamics Society, maybe look into: https://www.systemdynamics.org

## Maybe comparable/competing software
* Berkley Madonna
* Numerus: https://www.numerusinc.com/


## Resources
A good source of shiny examples and tips and tricks that might be helpful:
https://deanattali.com/blog/advanced-shiny-tips/
https://shiny.rstudio.com/articles/dynamic-ui.html
